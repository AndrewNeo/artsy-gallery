{% extends "_layout.html" %}
{% macro linkbox(linkobj) %}
    <ul>
    {% if linkobj.fa %}<li><a href="https://www.furaffinity.net/view/{{ linkobj.fa }}/">FurAffinity</a></li>{% endif %}
    {% if linkobj.weasyl %}<li><a href="{{ linkobj.weasyl }}">Weasyl</a></li>{% endif %}
    </ul>
{% endmacro %}
{% block title %}{{image.title}} by {{artist.name}}{% endblock %}
{% block content %}
    <h1>{{image.title}} by {{artist.name}}</h1>

    <div class="row">
        <div class="col-sm-12 col-md-7 col-lg-6">
            <p><a href="{{thumbnails.full}}"><img src="{{thumbnails.512}}" /></a></p>
            {% if image.description %}<p>{{image.description|markdown}}</p>{% endif %}
        </div>
        <div class="col-sm-12 col-md-5 col-lg-6">
            <h4>Characters</h4>
            <ul>
                {% for char_id in image.characters %}
                {% set char_data = get_character_breakdown(char_id) %}
                {% set character = char_data.character.get_parent() %}
                {% if not char_data.character.is_subform() %}
                <li><a href="../_characters/{{char_data.name}}.html#{{char_data.species_name}}">{{character.name}}</a> ({{get_species_details(char_data.species_name)}})</li>
                {% else %}
                {% set character = character.get_parent() %}
                <li><a href="../_characters/{{char_data.name}}.html#{{char_data.species_name}}_{{char_data.subform_name}}">{{character.name}}</a> ({{char_data.subform_name}} {{get_species_details(char_data.species_name)}})</li>
                {% endif %}
                {% endfor %}
            </ul>

            <h4>Tags</h4>
            <ul>
                {% for tag in image.tags %}
                {% if not tag.startswith("species#") %}
                {% set tagdet = get_tag_details(tag, as_none=True) %}
                <li><a href="../_tags/{{tag|replace('#','_')}}.html"{% if tagdet %} title="{{tagdet}}"{% endif %}>{{tag}}</a></li>
                {% endif %}
                {% endfor %}
            </ul>

            <h4>Species</h4>
            <ul>
                {% for species in image.get_species() %}
                <li><a href="../_species/{{species}}.html">{{get_species_details(species)}}</a></li>
                {% endfor %}
            </ul>

            {% if sequence %}
                {% macro format_link(image, seq, title, extra_test=True) %}
                    {% if seq and seq != image and extra_test %}<li><a href="../{{seq.get_artist().get_slug()}}/{{seq.slug}}.html">{{title}}</a></li>{% endif %}
                {% endmacro %}
                <h4>Sequence</h4>
                <ul>
                    {# Condense first+previous when they're the same image #}
                    {{format_link(image, sequence.first, "First", sequence.prev != sequence.first)}}
                    {{format_link(image, sequence.prev, "Previous")}}
                    {{format_link(image, sequence.next, "Next")}}
                    {{format_link(image, sequence.last, "Last", sequence.next != sequence.last)}}
                </ul>
            {% endif %}

            {% if image.artist_links %}
                <h4>Artist's links</h4>
                {{ linkbox(image.artist_links) }}
            {% endif %}
            {% if image.my_links %}
                <h4>My links</h4>
                {{ linkbox(image.my_links) }}
            {% endif %}
        </div>
    </div>
{% endblock %}